#!/bin/bash

#
# Created by Ken Hoo (mrkenhoo)
# archlinux-sbct file
# A tool to enable Secure Boot on Arch Linux systems
# For Arch Linux amd64
#
set -e

[ "$(whoami)" = "root" ] && \
    echo "Do not run this script as root, use sudo instead." && exit 1

[ ! -x "`command -v lsb_release`" ] && \
    sudo pacman -S lsb-release --noconfirm --needed

os=`lsb_release -ds | sed 's,",,g'`

[ "${os}" != "Arch Linux" ] && \
    echo "You must be using Arch Linux to execute this script." && exit 1

[ -z `pacman -Qqe | grep "preloader-signed"` ] && \
    echo "Please install this package to continue: preloader-signed" && exit 1

sudo cp -v /boot/EFI/BOOT/BOOTx64.efi /boot/EFI/BOOT/BOOTx64.efi.backup
sudo cp -v /usr/share/preloader-signed/HashTool.efi /boot/EFI/BOOT/
sudo cp -v /boot/EFI/systemd/systemd-bootx64.efi /boot/EFI/BOOT/loader.efi
sudo cp -v /usr/share/preloader-signed/PreLoader.efi /boot/EFI/BOOT/BOOTx64.efi

