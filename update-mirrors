#!/bin/sh
set -e

help() {
    printf "\nUsage: ${0} [OPTIONS]

Options:
--country,-c    Set the country to where fetch mirrors from
--sortby,-s     Sort mirrors by age, rate, speed, etc
--help,-h       Displays this message\n\n"
}

test -z $1 && help && exit 1

while getopts 'c:s:a' arg
do
    case $arg in
        c) country="$OPTARG";;
        s) sortby="$OPTARG";;
        a) append=1;;
        ?) help && exit 1;;
    esac
done

if test -z $country
then
    echo "Missing country"
    exit 1
elif test -z $sortby
then
    echo "Missing sorting type"
    exit 1
fi

test ! "$(command -v reflector)" && sudo pacman -S reflector

if test $append
then
    echo ":: Updating mirrors from $country and sorting them by $sortby, please wait..."
    reflector --country $country --sort $sortby --save /etc/pacman.d/mirrorlist
else
    echo ":: Updating mirrors from $country and sorting them by $sortby, please wait..."
    reflector --country $country --sort $sortby | sudo tee -a /etc/pacman.d/mirrorlist
fi

