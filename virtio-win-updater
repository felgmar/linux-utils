#!/usr/bin/sh
set -e

help() {
    printf "\nUsage: `basename $0` [OPTIONS]

Options:
    -d   Specifies the directory to where the ISOs will be downloaded to
    -h   Displays this message\n\n"
}

while getopts ':d:' arg
do
    case "$arg" in
        d) download_dir="$OPTARG";;
        h) help;;
	v) set -v;;
        ?) help;;
    esac
done

if test -z "$download_dir"
then
    help
    exit 1
fi

if test -x "`command -v curl`"
then
    echo "==> Removing old ISO images..."
    find ${download_dir} -type f -exec rm -iv {} \;

    printf "\n==> Fetching the latest virtio-win ISO...\n"
    curl -fSL \
        https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso \
        -o ${download_dir}/virtio-stable.iso

    printf "\n==> Fetching the stable virtio-win ISO...\n"
    curl -fSL \
        https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/virtio-win.iso \
        -o ${download_dir}/virtio-latest.iso
    else
        echo ":: ERROR: curl: command not found"
        exit 1
fi

