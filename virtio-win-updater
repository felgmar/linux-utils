#!/usr/bin/sh

help() {
    printf "\nUsage: ${0} [OPTIONS]

Options:
    --download-dir,-d   Specifies the directory to where the ISOs will be downloaded to
    --help,-h           Displays this message\n\n"
}

while [ $# -gt 0 ]; do
    case "${1}" in
        --download-dir|-d)
            shift
            downloadDir="${1}"
        ;;
        
        --help|-h)
            help
        ;;

        *)
            help
        ;;
    esac
    shift
done

if [ -z "${downloadDir}" ]; then
    help
    exit
fi

if [ -x "/usr/bin/curl" ]; then
    echo "==> Removing old ISO images..."
    for f in ${downloadDir}/*.iso; do
    	rm -v "${f}"
    done
    echo ""; echo "==> Fetching the latest virtio-win ISO..."
    curl -L https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso > ${downloadDir}/virtio-stable.iso
    if [ -f "${downloadDir}/virtio-stable.iso" ]; then
        echo "    --> Download successful"; echo ""
    fi

    echo ""; echo "==> Fetching the stable virtio-win ISO..."
    curl -L https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/latest-virtio/virtio-win.iso > ${downloadDir}/virtio-latest.iso
    if [ -f "${downloadDir}/virtio-latest.iso" ]; then
        echo "    --> Download successful"; echo ""
    fi
    else
        echo ":: ERROR: curl: command not found"
        exit 1
fi
